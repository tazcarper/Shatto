{"version":3,"sources":["map/jplist/controller/server.js"],"names":[],"mappings":"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","file":"map/jplist/controller/server.js","sourcesContent":["(function($){\n\t'use strict';\n\t\n\t/**\n\t* update statuses with data from server\n\t* @param {Object} self - jplist panel 'this' object\n\t* @param {Object} data - server data\n\t* @param {Array.<jQuery.fn.jplist.models.Status>} statuses\n\t*/\n\tvar setServerData = function(self, data, statuses){\n\t\n\t\tvar count = 0\n\t\t\t,status\n\t\t\t,pagingStatuses\n\t\t\t,paging;\n\t\t\n\t\tif(data.count && $.isNumeric(data.count)){\n\t\t\tcount = data.count;\n\t\t}\n\t\t\n\t\t//get list of pagination statuses\n\t\tpagingStatuses = jQuery.fn.jplist.services.Status.getStatusesByAction('paging', statuses);\n\t\t\n\t\tfor(var i=0; i<pagingStatuses.length; i++){\n\t\t\n\t\t\t//get pagination status\n\t\t\tstatus = pagingStatuses[i];\n\t\t\t\n\t\t\t//init current page\n\t\t\tif(!status.data.currentPage){\n\t\t\t\tstatus.data.currentPage = 0;\n\t\t\t}\n\t\t\t\n\t\t\t//create paging object\n\t\t\tpaging = new jQuery.fn.jplist.actions.Pagination(status.data.currentPage, status.data.number, count);\n\t\t\t\n\t\t\t//add paging object to the paging status\n\t\t\tpagingStatuses[i].data.paging = paging;\t\t\t\n\t\t}\n\t};\n\t\n\t/**\n\t* build result html\n\t* @param {Object} self - jplist panel 'this' object\n\t* @param {string} html\n\t* @param {Array.<jQuery.fn.jplist.models.Status>} statuses\n\t*/\n\tvar buildHtml = function(self, html, statuses){\n\t\t\n\t\t//update container html\n\t\tself.$itemsBox.html(html);\n\t\t\n\t\t//send readraw event\t\t\n\t\tself.$jplistBox.trigger(self.options.answer_event, [statuses, html]);\n\t\t\n\t\t//no results found\n\t\tif(!html || $.trim(html) === ''){\n\t\t\tself.$noResults.removeClass('jplist-hidden');\n\t\t\tself.$itemsBox.addClass('jplist-hidden');\n\t\t}\n\t\telse{\n\t\t\tself.$noResults.addClass('jplist-hidden');\n\t\t\tself.$itemsBox.removeClass('jplist-hidden');\n\t\t}\n\t\t\n\t\t//redraw callback\n\t\tif($.isFunction(self.options.redraw_callback)){\n\t\t\tself.options.redraw_callback();\n\t\t}\n\t};\n\t\n\t/**\n\t* init events\n\t* @param {Object} self - jplist controller 'this' object\n\t*/\n\tvar initEvents = function(self){\n\t\n\t\t//on ask event\n\t\tself.$jplistBox.on(self.options.ask_event, function(event, statuses){\n\t\t\t\t\t\t\n\t\t\t//hide items box\n\t\t\tself.$itemsBox.addClass('jplist-hidden');\n\t\t\t\n\t\t\t//hide no results section\n\t\t\tself.$noResults.addClass('jplist-hidden');\n\t\t\t\n\t\t\t//show preloader\n\t\t\tif(self.$preloader){\n\t\t\t\tself.$preloader.removeClass('jplist-hidden');\n\t\t\t}\n\t\t\t\n\t\t\t//save statuses in cookies\n\t\t\tif(self.options.cookies){\n\t\t\t\tjQuery.fn.jplist.services.Cookies.saveCookies(statuses, self.options.cookie_name, self.options.expiration);\n\t\t\t}\n\t\t\t\n\t\t\tif(!self.options.dataSource.server.ajax.data){\n\t\t\t\tself.options.dataSource.server.ajax.data = {};\n\t\t\t}\n\t\t\t\n\t\t\t//add statuses to the data array\n\t\t\tself.options.dataSource.server.ajax.data.statuses = encodeURIComponent(JSON.stringify(statuses));\n\t\t\t\t\t\t\n\t\t\t//send ajax request to the server\n\t\t\t$.ajax(self.options.dataSource.server.ajax).done(function(serverData){\n\t\t\t\n\t\t\t\tvar json = {\n\t\t\t\t\thtml: ''\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\t//hide preloader\n\t\t\t\tif(self.$preloader){\n\t\t\t\t\tself.$preloader.addClass('jplist-hidden');\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t//show items box\n\t\t\t\tself.$itemsBox.removeClass('jplist-hidden');\n\t\t\t\t\n\t\t\t\tif(serverData){\n\t\t\t\t\tjson = $.parseJSON(serverData);\n\t\t\t\t\t\n\t\t\t\t\tif(!json.html){\n\t\t\t\t\t\tjson.html = '';\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif(json.data){\t\t\t\t\t\t\n\t\t\t\t\t\tsetServerData(self, json.data, statuses);\t\t\t\t\t\t\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t//build result html\n\t\t\t\t\tbuildHtml(self, json.html, statuses);\n\n                    //trigger collection ready event\n\t\t\t        //self.$jplistBox.trigger(self.options.collection_ready_event, [serverData]);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t//server ok callback\n\t\t\t\tif($.isFunction(self.options.dataSource.server.serverOkCallback)){\n\t\t\t\t\tself.options.dataSource.server.serverOkCallback(json.html, statuses);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.fail(function(){\n\t\t\t\n\t\t\t\t//server ok callback\n\t\t\t\tif($.isFunction(self.options.dataSource.server.serverErrorCallback)){\n\t\t\t\t\tself.options.dataSource.server.serverErrorCallback(statuses);\n\t\t\t\t}\n\t\t\t});\n\t\t});\t\t\n\t};\n\t\n\t/**\n\t* server constructor\n\t* @param {jQueryObject} $jplistBox - jplist jquery element\n\t* @param {jQueryObject} $itemsBox - jplist items container\n\t* @param {jQueryObject} $noResults - jplist no results element\n\t* @param {Object} options - jplist user options\n\t* @return {Object} - server + this\t\n\t* @constructor \n\t*/\n\tvar Init = function($jplistBox, $itemsBox, $noResults, options){\n\t\n\t\tvar self = {\n\t\t\toptions: options\n\t\t\t,$jplistBox: $jplistBox\n\t\t\t,$itemsBox: $itemsBox\n\t\t\t,$noResults: $noResults\n\t\t\t,$preloader: null\n\t\t};\t\n\t\t\n\t\t//init preloader\n\t\tif(self.options.dataSource.server.preloaderPath){\n\t\t\tself.$preloader = self.$jplistBox.find(self.options.dataSource.server.preloaderPath);\n\t\t}\n\t\t\n\t\t//init events\n\t\tinitEvents(self);\n\t\t\t\t\n\t\treturn $.extend(this, self);\n\t};\n\t\n\t/**\n\t* Server\n\t* @param {jQueryObject} $jplistBox - jplist root element\n\t* @param {jQueryObject} $itemsBox - jplist items container\n\t* @param {jQueryObject} $noResults - jplist no results element\n\t* @param {Object} options - jplist user options\n\t* @return {Object} - server\n\t* @constructor \n\t*\n    * @class Server - ajax as data source (instead of HTML/DOM)\n    * @memberOf jQuery.fn.jplist\n\t* @property {Object} options - user options\n\t* @property {jQueryObject} $jplistBox - jplist root element\n\t* @property {jQueryObject} $itemsBox - jplist items container\n\t* @property {jQueryObject} $noResults - jplist no results element\n\t*/\n\tjQuery.fn.jplist.controller.Server = function($jplistBox, $itemsBox, $noResults, options){\n\t\t\t\t\n\t\t//call constructor\n\t\treturn new Init($jplistBox, $itemsBox, $noResults, options);\n\t};\n})(jQuery);"],"sourceRoot":"/source/"}